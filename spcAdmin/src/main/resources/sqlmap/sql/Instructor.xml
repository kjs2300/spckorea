<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.easycompany.mapper.InstructorMapper">
	<!-- 유저 -->
	<select id="getBoardList" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT BOARD_IDX,
	    CASE BOARD_TYPE
	 		WHEN 05 THEN '강사공지'
	 		WHEN 06 THEN '강사자료실'
		 END AS BOARD_TYPE,
	    TITLE, LINK_URL, FILE_ID, VIEW_CNT, CAST( DATE_FORMAT( REG_DT, '%Y-%m-%d' ) AS CHAR(19) ) AS REG_DT, REG_ID, REG_NM,
	    (SELECT COUNT(*) FROM edu_file WHERE FILE_KEY = BOARD_IDX AND FILE_GUBUN = 'board') AS FIEL_CNT, CONTENTS
	      FROM edu_board
	     WHERE USE_YN = 'Y'
	     <if test="searchCondition !=null and searchCondition == 'ALL'">
	      	AND (TITLE LIKE CONCAT('%', #{searchKeyword}, '%') OR REG_ID LIKE CONCAT('%', #{searchKeyword}, '%') OR CONTENTS LIKE CONCAT('%', #{searchKeyword}, '%'))
	      </if>
	      <if test="searchCondition !=null and searchCondition == 'TITLE'">
	      	AND TITLE LIKE CONCAT('%', #{searchKeyword}, '%')
	      </if>
	      <if test="searchCondition !=null and searchCondition == 'REG_NM'">
	      	AND REG_ID LIKE CONCAT('%', #{searchKeyword}, '%')
	      </if>
	      <if test="searchCondition !=null and searchCondition == 'CONTENTS'">
	      	AND CONTENTS LIKE CONCAT('%', #{searchKeyword}, '%')
	      </if>
	      <if test="searchDate !=null and searchDate != 'ALL'">
	      	<![CDATA[
		       AND CAST( DATE_FORMAT( REG_DT, '%Y-%m-%d' ) AS CHAR(19)) >= #{board_start_date} AND CAST( DATE_FORMAT( REG_DT, '%Y-%m-%d' ) AS CHAR(19)) <= #{board_end_date} 
	        ]]>
	      </if>
	      <if test="board_type !=null and board_type != ''">
	      	AND BOARD_TYPE = #{board_type}
	      </if>
	     ORDER BY BOARD_IDX DESC
	    LIMIT #{recordCountPerPage}  OFFSET  #{offset}
	</select>

	<select id="getBoardCount" parameterType="java.util.Map" resultType="int">
		SELECT COUNT(*) cnt
	       FROM edu_board
	      WHERE USE_YN = 'Y'
	     <if test="searchCondition !=null and searchCondition == 'ALL'">
	      	AND (TITLE LIKE CONCAT('%', #{searchKeyword}, '%') OR REG_ID LIKE CONCAT('%', #{searchKeyword}, '%') OR CONTENTS LIKE CONCAT('%', #{searchKeyword}, '%'))
	      </if>
	      <if test="searchCondition !=null and searchCondition == 'TITLE'">
	      	AND TITLE LIKE CONCAT('%', #{searchKeyword}, '%')
	      </if>
	      <if test="searchCondition !=null and searchCondition == 'REG_NM'">
	      	AND REG_ID LIKE CONCAT('%', #{searchKeyword}, '%')
	      </if>
	      <if test="searchCondition !=null and searchCondition == 'CONTENTS'">
	      	AND CONTENTS LIKE CONCAT('%', #{searchKeyword}, '%')
	      </if>
	      <if test="searchDate !=null and searchDate != 'ALL'">
	      	<![CDATA[
		       AND CAST( DATE_FORMAT( REG_DT, '%Y-%m-%d' ) AS CHAR(19)) >= #{board_start_date} AND CAST( DATE_FORMAT( REG_DT, '%Y-%m-%d' ) AS CHAR(19)) <= #{board_end_date} 
	        ]]>
	      </if>
	      <if test="board_type !=null and board_type != ''">
	      	AND BOARD_TYPE = #{board_type}
	      </if>
	</select>
	
	<select id="getBoardView" parameterType="java.util.Map" resultType="java.util.Map">
	SELECT BOARD_IDX, BOARD_TYPE, TITLE, CONTENTS, LINK_URL, FILE_ID, VIEW_CNT, CAST( DATE_FORMAT( REG_DT, '%Y-%m-%d' ) AS CHAR(19) ) AS REG_DT, REG_NM
		       ,EDU_TYPE_01, EDU_TYPE_02, EDU_TYPE_03, EDU_TYPE_04, EDU_TYPE_05, EDU_TYPE_06, EDU_TYPE_07, EDU_TYPE_08, EDU_TYPE_09, EDU_TYPE_10, EDU_TYPE_11
	      <![CDATA[
	      ,(SELECT b.BOARD_IDX FROM EDU_BOARD b WHERE b.BOARD_TYPE = #{board_type} AND b.BOARD_IDX > #{board_idx} AND USE_YN = 'Y' ORDER BY BOARD_IDX DESC LIMIT 1) AS NEXT_IDX
	      ,(SELECT b.TITLE FROM EDU_BOARD b WHERE b.BOARD_TYPE = #{board_type} AND b.BOARD_IDX > #{board_idx} AND USE_YN = 'Y' ORDER BY BOARD_IDX DESC LIMIT 1) AS NEXT_NM
	      ,(SELECT b.BOARD_IDX FROM EDU_BOARD b WHERE b.BOARD_TYPE = #{board_type} AND b.BOARD_IDX < #{board_idx} AND USE_YN = 'Y' ORDER BY BOARD_IDX LIMIT 1) AS PREV_IDX
	      ,(SELECT b.TITLE FROM EDU_BOARD b WHERE b.BOARD_TYPE = #{board_type} AND b.BOARD_IDX < #{board_idx} AND USE_YN = 'Y' ORDER BY BOARD_IDX LIMIT 1) AS PREV_NM
	      ]]>
	     <if test="board_type !=null and board_type == '06'">
		    , NOTICE_YN
         </if>
	      FROM edu_board
	     WHERE 1=1
	    	AND BOARD_IDX = #{board_idx}
	    	AND USE_YN = 'Y'
	    	<if test="board_type !=null and board_type != ''">
	      	AND BOARD_TYPE = #{board_type}
	      </if>
	</select>
	
	
	<!-- 관리자 -->
	<select id="getCodeList" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT CD, CD_NM FROM COM_CD_MNG WHERE UP_CD_NO = '${code}'
	</select>
</mapper>
