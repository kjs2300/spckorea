<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.easycompany.mapper.MyMapper">
	<select id="getCartList" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT a.BASKET_NO,b.EDU_TIME,b.INST_NM,b.EDU_NO,a.user_id
			   ,(SELECT CATEGORY3_NAME FROM EDU_CLASS_CATEGORY3 WHERE CATEGORY3_KEY = b.CATEGORY3_KEY) AS CATEGORY3_NAME
		FROM EDU_BASKET a, 
			 EDU_REGISTRATION b
		WHERE 1=1
		AND a.EDU_NO = b.EDU_NO
		AND b.CATEGORY1_KEY = #{category1_key}
		AND a.USER_ID = #{UserAccount.user_id}
		ORDER BY BASKET_NO DESC
		LIMIT #{recordCountPerPage} OFFSET #{offset}
	</select>

	<select id="getCartListCnt" parameterType="java.util.Map" resultType="int">
		SELECT COUNT(*) 
		 FROM EDU_BASKET a, 
			 EDU_REGISTRATION b
		WHERE 1=1
		AND a.EDU_NO = b.EDU_NO
		AND b.CATEGORY1_KEY = #{category1_key}
		AND a.USER_ID = #{UserAccount.user_id}
	</select>
	
	<delete id="deleteCart" parameterType="java.util.Map">	
		DELETE FROM EDU_BASKET
		WHERE BASKET_NO IN (
			<foreach collection="basketList" item="item" separator=",">
				#{item}
			</foreach>
		) 
	</delete>
	
	<delete id="deleteCour" parameterType="java.util.Map">	
		DELETE FROM EDU_COURSE_REGISTRATION
		WHERE COUR_NO IN (
			<foreach collection="basketList" item="item" separator=",">
				#{item}
			</foreach>
		) 
	</delete>
	
	<select id="getStatusList" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT  (SELECT CATEGORY1_NAME FROM EDU_CLASS_CATEGORY1 WHERE CATEGORY1_KEY = b.CATEGORY1_KEY) AS CATEGORY1_NAME
				,(SELECT CATEGORY2_NAME FROM EDU_CLASS_CATEGORY2 WHERE CATEGORY2_KEY = b.CATEGORY2_KEY) AS CATEGORY2_NAME
		        ,(SELECT CATEGORY3_NAME FROM EDU_CLASS_CATEGORY3 WHERE CATEGORY3_KEY = b.CATEGORY3_KEY) AS CATEGORY3_NAME
		        ,DATE_FORMAT(a.REG_DT,'%Y-%m-%d') AS REG_DT, b.INST_NM
                ,CASE WHEN b.TRAIN_S_DATE > NOW() THEN 'Y' ELSE 'N' END AS CANCEL_CHECK 
		FROM EDU_COURSE_REGISTRATION a, 
			 EDU_REGISTRATION b
		WHERE a.EDU_NO = b.EDU_NO
		AND (USE_YN = 'Y' OR USE_YN IS NULL)
		AND a.USER_ID = #{UserAccount.user_id}
		<if test="category1_key != '' and category1_key != null">
			AND b.CATEGORY1_KEY = #{category1_key}
		</if>
		<if test="category2_key != '' and category2_key != null">
			AND b.CATEGORY2_KEY = #{category2_key}
		</if>
		<if test="category3_key != '' and category3_key != null">
			AND b.CATEGORY3_KEY = #{category3_key}
		</if>
		<choose>
			<when test="searchDate !=null and searchDate !='' and searchDate =='ALL' ">
			</when>
			<when
				test="searchDate !=null and searchDate !='' and searchDate =='TODAY' ">
				AND REG_DT = NOW()
			</when>
			<when
				test="searchDate !=null and searchDate !='' and searchDate =='CHECK' ">
		      <![CDATA[
		       AND  REG_DT >= #{start_date} AND REG_DT <= #{end_date} 
		       ]]>
			</when>
		</choose>
		ORDER BY COUR_NO DESC
		LIMIT #{recordCountPerPage} OFFSET #{offset}
	</select>
	
	<select id="getStatusListCnt" parameterType="java.util.Map" resultType="int">
		SELECT COUNT(*) 
		 FROM EDU_COURSE_REGISTRATION a, 
			 EDU_REGISTRATION b
		WHERE a.EDU_NO = b.EDU_NO
		AND (USE_YN = 'Y' OR USE_YN IS NULL)
		AND a.USER_ID = #{UserAccount.user_id}
		<if test="category1_key != '' and category1_key != null">
			AND b.CATEGORY1_KEY = #{category1_key}
		</if>
		<if test="category2_key != '' and category2_key != null">
			AND b.CATEGORY2_KEY = #{category2_key}
		</if>
		<if test="category3_key != '' and category3_key != null">
			AND b.CATEGORY3_KEY = #{category3_key}
		</if>
		<choose>
			<when test="searchDate !=null and searchDate !='' and searchDate =='ALL' ">
			</when>
			<when
				test="searchDate !=null and searchDate !='' and searchDate =='TODAY' ">
				AND REG_DT = NOW()
			</when>
			<when
				test="searchDate !=null and searchDate !='' and searchDate =='CHECK' ">
		      <![CDATA[
		       AND  REG_DT >= #{start_date} AND REG_DT <= #{end_date} 
		       ]]>
			</when>
		</choose>
	</select>
	
	<select id="getEduAllCnt" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT  COUNT(c.COUR_NO) AS ALL_CNT,
				COUNT(CASE WHEN COUR_STAT=1 THEN 1 END) AS END_CNT,
		        COUNT(CASE WHEN COUR_STAT!=1 THEN 1 END) AS ING_CNT
		FROM (
			SELECT  a.COUR_NO
			,a.COUR_STAT
			FROM EDU_COURSE_REGISTRATION a, 
				 EDU_REGISTRATION b
			WHERE a.EDU_NO = b.EDU_NO
			AND a.USER_ID = #{UserAccount.user_id}
			<![CDATA[
			AND TRAIN_S_DATE <= NOW() 
	        ]]>
			<if test="category1_key != '' and category1_key != null">
				AND b.CATEGORY1_KEY = #{category1_key}
			</if>
			<if test="category2_key != '' and category2_key != null">
				AND b.CATEGORY2_KEY = #{category2_key}
			</if>
			<if test="category3_key != '' and category3_key != null">
				AND b.CATEGORY3_KEY = #{category3_key}
			</if>
			<choose>
				<when test="searchDate !=null and searchDate !='' and searchDate =='ALL' ">
				</when>
				<when
					test="searchDate !=null and searchDate !='' and searchDate =='TODAY' ">
					AND REG_DT = NOW()
				</when>
				<when
					test="searchDate !=null and searchDate !='' and searchDate =='CHECK' ">
			      <![CDATA[
			       AND  REG_DT >= #{start_date} AND REG_DT <= #{end_date} 
			       ]]>
				</when>
			</choose>
			) c
	</select>
	
	<select id="getEduList" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT  (SELECT CATEGORY1_NAME FROM EDU_CLASS_CATEGORY1 WHERE CATEGORY1_KEY = b.CATEGORY1_KEY) AS CATEGORY1_NAME
				,(SELECT CATEGORY2_NAME FROM EDU_CLASS_CATEGORY2 WHERE CATEGORY2_KEY = b.CATEGORY2_KEY) AS CATEGORY2_NAME
		        ,(SELECT CATEGORY3_NAME FROM EDU_CLASS_CATEGORY3 WHERE CATEGORY3_KEY = b.CATEGORY3_KEY) AS CATEGORY3_NAME
		        ,DATE_FORMAT(a.REG_DT,'%Y-%m-%d') AS REG_DT, b.INST_NM
		        ,a.USER_NM, a.COUR_NO
		        ,CASE a.COUR_STAT
			 		WHEN 1 THEN '완료'
			 		ELSE '미완료'
				 END AS COUR_STAT 
				,CASE a.COUR_STAT
			 		WHEN 1 THEN '교육완료'
			 		ELSE '교육전'
				 END AS OFF_STAT   <!-- //교육기간 확인후 수정 -->   
		FROM EDU_COURSE_REGISTRATION a, 
			 EDU_REGISTRATION b
		WHERE a.EDU_NO = b.EDU_NO
		AND a.USER_ID = #{UserAccount.user_id}
		AND b.EDU_SITE = #{site}
		<![CDATA[
		AND TRAIN_S_DATE <= NOW() 
        ]]>
		<if test="edu_status != '' and edu_status != null">
			AND COUR_STAT = #{edu_status}
		</if>
		<if test="category1_key != '' and category1_key != null">
			AND b.CATEGORY1_KEY = #{category1_key}
		</if>
		<if test="category2_key != '' and category2_key != null">
			AND b.CATEGORY2_KEY = #{category2_key}
		</if>
		<if test="category3_key != '' and category3_key != null">
			AND b.CATEGORY3_KEY = #{category3_key}
		</if>
		<choose>
			<when test="searchDate !=null and searchDate !='' and searchDate =='ALL' ">
			</when>
			<when
				test="searchDate !=null and searchDate !='' and searchDate =='TODAY' ">
				AND a.REG_DT = NOW()
			</when>
			<when
				test="searchDate !=null and searchDate !='' and searchDate =='CHECK' ">
		      <![CDATA[
		       AND  a.REG_DT >= #{start_date} AND a.REG_DT <= #{end_date} 
		       ]]>
			</when>
		</choose>
		ORDER BY COUR_NO DESC
		LIMIT #{recordCountPerPage} OFFSET #{offset}
	</select>
	
	<select id="getEduListCnt" parameterType="java.util.Map" resultType="int">
		SELECT COUNT(*) 
		 FROM EDU_COURSE_REGISTRATION a, 
			 EDU_REGISTRATION b
		WHERE a.EDU_NO = b.EDU_NO
		AND a.USER_ID = #{UserAccount.user_id}
		AND b.EDU_SITE = #{site}
		<![CDATA[
        AND TRAIN_S_DATE <= NOW() 
        ]]>
		<if test="edu_status != ''">
			AND a.COUR_STAT = 1
		</if>
		<if test="category1_key != '' and category1_key != null">
			AND b.CATEGORY1_KEY = #{category1_key}
		</if>
		<if test="category2_key != '' and category2_key != null">
			AND b.CATEGORY2_KEY = #{category2_key}
		</if>
		<if test="category3_key != '' and category3_key != null">
			AND b.CATEGORY3_KEY = #{category3_key}
		</if>
		<choose>
			<when test="searchDate !=null and searchDate !='' and searchDate =='ALL' ">
			</when>
			<when
				test="searchDate !=null and searchDate !='' and searchDate =='TODAY' ">
				AND a.REG_DT = NOW()
			</when>
			<when
				test="searchDate !=null and searchDate !='' and searchDate =='CHECK' ">
		      <![CDATA[
		       AND  a.REG_DT >= #{start_date} AND a.REG_DT <= #{end_date} 
		       ]]>
			</when>
		</choose>
	</select>
	
	<select id="getEduIngList" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT  (SELECT CATEGORY1_NAME FROM EDU_CLASS_CATEGORY1 WHERE CATEGORY1_KEY = b.CATEGORY1_KEY) AS CATEGORY1_NAME
				,(SELECT CATEGORY2_NAME FROM EDU_CLASS_CATEGORY2 WHERE CATEGORY2_KEY = b.CATEGORY2_KEY) AS CATEGORY2_NAME
		        ,(SELECT CATEGORY3_NAME FROM EDU_CLASS_CATEGORY3 WHERE CATEGORY3_KEY = b.CATEGORY3_KEY) AS CATEGORY3_NAME
		        ,DATE_FORMAT(a.REG_DT,'%Y-%m-%d') AS REG_DT, b.INST_NM, b.EDU_TIME
		        ,IFNULL(TIME_FORMAT(SEC_TO_TIME(FLOOR(a.COUR_TIME)),'%i'),'00') AS COUR_TIME_MIN
		        ,IFNULL(TIME_FORMAT(SEC_TO_TIME(FLOOR(a.COUR_TIME)),'%s'),'00') AS COUR_TIME_SEC
		        ,a.USER_NM, a.COUR_NO, b.EDU_NO
		        ,CASE a.COUR_STAT
			 		WHEN 1 THEN '완료'
			 		ELSE '미완료'
				 END AS COUR_STAT         
		FROM EDU_COURSE_REGISTRATION a, 
			 EDU_REGISTRATION b
		WHERE a.EDU_NO = b.EDU_NO
		AND a.USER_ID = #{UserAccount.user_id}
		<![CDATA[
		AND TRAIN_S_DATE <= NOW() 
        ]]>
		AND (a.COUR_STAT != '1' OR a.COUR_STAT IS NULL)
		<choose>
			<when test="searchDate !=null and searchDate !='' and searchDate =='ALL' ">
			</when>
			<when
				test="searchDate !=null and searchDate !='' and searchDate =='TODAY' ">
				AND a.REG_DT = NOW()
			</when>
			<when
				test="searchDate !=null and searchDate !='' and searchDate =='CHECK' ">
		      <![CDATA[
		       AND  a.REG_DT >= #{start_date} AND a.REG_DT <= #{end_date} 
		       ]]>
			</when>
		</choose>
		<if test="edu_name != '' and edu_name != null">
			AND b.CATEGORY3_NAME = #{edu_name}
		</if>
		ORDER BY COUR_NO DESC
	</select>
	
	<select id="getEduEndList" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT  (SELECT CATEGORY1_NAME FROM EDU_CLASS_CATEGORY1 WHERE CATEGORY1_KEY = b.CATEGORY1_KEY) AS CATEGORY1_NAME
				,(SELECT CATEGORY2_NAME FROM EDU_CLASS_CATEGORY2 WHERE CATEGORY2_KEY = b.CATEGORY2_KEY) AS CATEGORY2_NAME
		        ,(SELECT CATEGORY3_NAME FROM EDU_CLASS_CATEGORY3 WHERE CATEGORY3_KEY = b.CATEGORY3_KEY) AS CATEGORY3_NAME
		        ,DATE_FORMAT(a.REG_DT,'%Y-%m-%d') AS REG_DT, b.INST_NM, b.EDU_TIME
		        ,TIME_FORMAT(SEC_TO_TIME(FLOOR(a.COUR_TIME)),'%i') AS COUR_TIME_MIN
		        ,TIME_FORMAT(SEC_TO_TIME(FLOOR(a.COUR_TIME)),'%s') AS COUR_TIME_SEC
		        ,a.USER_NM, a.COUR_NO, b.EDU_NO
		        ,CASE a.COUR_STAT
			 		WHEN 1 THEN '완료'
			 		ELSE '미완료'
				 END AS COUR_STAT         
		FROM EDU_COURSE_REGISTRATION a, 
			 EDU_REGISTRATION b
		WHERE a.EDU_NO = b.EDU_NO
		AND a.USER_ID = #{UserAccount.user_id}
		<![CDATA[
		AND TRAIN_S_DATE <= NOW() 
        ]]>
		AND COUR_STAT = '1'
		<choose>
			<when test="searchDate !=null and searchDate !='' and searchDate =='ALL' ">
			</when>
			<when
				test="searchDate !=null and searchDate !='' and searchDate =='TODAY' ">
				AND REG_DT = NOW()
			</when>
			<when
				test="searchDate !=null and searchDate !='' and searchDate =='CHECK' ">
		      <![CDATA[
		       AND  REG_DT >= #{start_date} AND REG_DT <= #{end_date} 
		       ]]>
			</when>
		</choose>
		<if test="edu_name != '' and edu_name != null">
			AND b.CATEGORY3_NAME = #{edu_name}
		</if>
		ORDER BY COUR_NO DESC
	</select>
	
	<select id="getOnclassTime" parameterType="java.util.Map" resultType="java.util.Map">
	SELECT  COUR_TIME,COUR_STAT
		FROM EDU_COURSE_REGISTRATION
		 WHERE 1=1
		  AND COUR_NO = #{cour_no}
		  AND EDU_NO = #{edu_no}
	</select>

	<update id="onclassUpdate" parameterType="java.util.Map">	
		UPDATE EDU_COURSE_REGISTRATION
		SET COUR_TIME = #{cour_time}, COUR_STAT = #{cour_stat}
			<if test="cour_stat == '1' and category2_key != null">
			,AND CHG_DT = NOW()
			</if>
		WHERE COUR_NO = #{cour_no}
		  AND EDU_NO = #{edu_no}
	</update>
	
	<select id="getWarrantList" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT  (SELECT CATEGORY1_NAME FROM EDU_CLASS_CATEGORY1 WHERE CATEGORY1_KEY = b.CATEGORY1_KEY) AS CATEGORY1_NAME
				,(SELECT CATEGORY2_NAME FROM EDU_CLASS_CATEGORY2 WHERE CATEGORY2_KEY = b.CATEGORY2_KEY) AS CATEGORY2_NAME
		        ,(SELECT CATEGORY3_NAME FROM EDU_CLASS_CATEGORY3 WHERE CATEGORY3_KEY = b.CATEGORY3_KEY) AS CATEGORY3_NAME
		        ,DATE_FORMAT(a.REG_DT,'%Y-%m-%d') AS REG_DT, b.INST_NM
		        ,a.USER_NM, a.COUR_NO, a.EDU_NO
		        ,DATE_FORMAT(a.LICENSE_PBL_DATE,'%Y-%m-%d') AS LICENSE_PBL_DATE
		        ,CASE a.LICENSE_PBL
			 		WHEN 1 THEN '발급'
			 		ELSE '미발급'
				 END AS LICENSE_PBL         
		FROM EDU_COURSE_REGISTRATION a, 
			 EDU_REGISTRATION b
		WHERE a.EDU_NO = b.EDU_NO
		AND a.USER_ID = #{UserAccount.user_id}
		<![CDATA[
		AND TRAIN_S_DATE <= NOW() 
        ]]>
		AND COUR_STAT = 1
		<if test="category1_key != '' and category1_key != null">
			AND b.CATEGORY1_KEY = #{category1_key}
		</if>
		<if test="category2_key != '' and category2_key != null">
			AND b.CATEGORY2_KEY = #{category2_key}
		</if>
		<if test="category3_key != '' and category3_key != null">
			AND b.CATEGORY3_KEY = #{category3_key}
		</if>
		<choose>
			<when test="searchDate !=null and searchDate !='' and searchDate =='ALL' ">
			</when>
			<when test="searchDate !=null and searchDate !='' and searchDate =='TODAY' ">
				AND a.REG_DT = NOW()
			</when>
			<when test="searchDate !=null and searchDate !='' and searchDate =='CHECK' ">
		      <![CDATA[
		       AND  a.REG_DT >= #{start_date} AND a.REG_DT <= #{end_date} 
		       ]]>
			</when>
		</choose>
		<choose>
			<when test="license_pbl !=null and license_pbl !='' and license_pbl =='ALL' ">
			</when>
			<when test="license_pbl !=null and license_pbl !='' and license_pbl =='1' ">
				AND LICENSE_PBL = '1'
			</when>
			<when test="license_pbl !=null and license_pbl !='' and license_pbl =='2' ">
		      	AND LICENSE_PBL = '2'
			</when>
		</choose>
		ORDER BY COUR_NO DESC
		LIMIT #{recordCountPerPage} OFFSET #{offset}
	</select>
	
	<select id="getWarrantListCnt" parameterType="java.util.Map" resultType="int">
		SELECT COUNT(*) 
		FROM EDU_COURSE_REGISTRATION a, 
			 EDU_REGISTRATION b
		WHERE a.EDU_NO = b.EDU_NO
		AND a.USER_ID = #{UserAccount.user_id}
		<![CDATA[
		AND TRAIN_S_DATE <= NOW() 
        ]]>
		AND COUR_STAT = 1
		<if test="category1_key != '' and category1_key != null">
			AND b.CATEGORY1_KEY = #{category1_key}
		</if>
		<if test="category2_key != '' and category2_key != null">
			AND b.CATEGORY2_KEY = #{category2_key}
		</if>
		<if test="category3_key != '' and category3_key != null">
			AND b.CATEGORY3_KEY = #{category3_key}
		</if>
		<choose>
			<when test="searchDate !=null and searchDate !='' and searchDate =='ALL' ">
			</when>
			<when
				test="searchDate !=null and searchDate !='' and searchDate =='TODAY' ">
				AND a.REG_DT = NOW()
			</when>
			<when
				test="searchDate !=null and searchDate !='' and searchDate =='CHECK' ">
		      <![CDATA[
		       AND  a.REG_DT >= #{start_date} AND a.REG_DT <= #{end_date} 
		       ]]>
			</when>
		</choose>
		<choose>
			<when test="license_pbl !=null and license_pbl !='' and license_pbl =='ALL' ">
			</when>
			<when test="license_pbl !=null and license_pbl !='' and license_pbl =='1' ">
				AND LICENSE_PBL = '1'
			</when>
			<when test="license_pbl !=null and license_pbl !='' and license_pbl =='2' ">
		      	AND LICENSE_PBL = '2'
			</when>
		</choose>
	</select>
	
	<select id="getMyWarrant" parameterType="java.util.Map" resultType="java.util.Map">
	SELECT  a.USER_NM, a.USER_ID
			,(SELECT CATEGORY3_NAME FROM EDU_CLASS_CATEGORY3 WHERE CATEGORY3_KEY = b.CATEGORY3_KEY) AS CATEGORY3_NAME
			,DATE_FORMAT(a.CHG_DT,'%Y') AS DATE_Y
			,DATE_FORMAT(a.CHG_DT,'%m') AS DATE_M
			,DATE_FORMAT(a.CHG_DT,'%d') AS DATE_D
            ,DATE_FORMAT(NOW(), '%y') AS NOWYEAR
            ,c.LICENSE_NUMBER
            ,(SELECT COPER_NM FROM COM_USER WHERE USER_ID = a.USER_ID) AS COPER_NM
            ,DATE_FORMAT(c.REG_DT,'%Y') AS CDATE_Y
			,DATE_FORMAT(c.REG_DT,'%m') AS CDATE_M
			,DATE_FORMAT(c.REG_DT,'%d') AS CDATE_D
		FROM EDU_COURSE_REGISTRATION a,
			 EDU_REGISTRATION b,
             EDU_USER_LICENSE c
		 WHERE 1=1
		  AND a.EDU_NO = b.EDU_NO
		  AND a.EDU_NO = c.EDU_NO
          AND a.COUR_NO = c.COUR_NO
		  AND a.COUR_NO = #{cour_no}
		  AND a.EDU_NO = #{edu_no}
	</select>
	
	<select id="getMyList" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT BOARD_IDX,
	    TITLE, LINK_URL, FILE_ID, VIEW_CNT, CAST( DATE_FORMAT( REG_DT, '%Y-%m-%d' ) AS CHAR(19) ) AS REG_DT, REG_ID, REG_NM,
	    (SELECT COUNT(*) FROM edu_file WHERE FILE_KEY = BOARD_IDX AND FILE_GUBUN = 'board') AS FIEL_CNT, CONTENTS
	      FROM edu_board
		WHERE REG_ID = #{UserAccount.user_id}
		<choose>
			<when test="searchDate !=null and searchDate !='' and searchDate =='ALL' ">
			</when>
			<when test="searchDate !=null and searchDate !='' and searchDate =='TODAY' ">
				AND CAST( DATE_FORMAT( REG_DT, '%Y-%m-%d' ) AS CHAR(19)) = NOW()
			</when>
			<when test="searchDate !=null and searchDate !='' and searchDate =='CHECK' ">
		      <![CDATA[
		       AND CAST( DATE_FORMAT( REG_DT, '%Y-%m-%d' ) AS CHAR(19)) >= #{start_date} 
		       AND CAST( DATE_FORMAT( REG_DT, '%Y-%m-%d' ) AS CHAR(19)) <= #{end_date} 
		       ]]>
			</when>
		</choose>
	     ORDER BY BOARD_IDX DESC
		LIMIT #{recordCountPerPage} OFFSET #{offset}
	</select>
	
	<select id="getMyListCnt" parameterType="java.util.Map" resultType="int">
		SELECT COUNT(*) 
		  FROM edu_board
		WHERE REG_ID = #{UserAccount.user_id}
		<choose>
			<when test="searchDate !=null and searchDate !='' and searchDate =='ALL' ">
			</when>
			<when test="searchDate !=null and searchDate !='' and searchDate =='TODAY' ">
				AND CAST( DATE_FORMAT( REG_DT, '%Y-%m-%d' ) AS CHAR(19)) = NOW()
			</when>
			<when test="searchDate !=null and searchDate !='' and searchDate =='CHECK' ">
		      <![CDATA[
		       AND CAST( DATE_FORMAT( REG_DT, '%Y-%m-%d' ) AS CHAR(19)) >= #{start_date} 
		       AND CAST( DATE_FORMAT( REG_DT, '%Y-%m-%d' ) AS CHAR(19)) <= #{end_date} 
		       ]]>
			</when>
		</choose>
	</select>
	
	<update id="myWarrantUpdate" parameterType="java.util.Map">	
		UPDATE EDU_COURSE_REGISTRATION
		SET COUR_TIME = #{cour_time}, COUR_STAT = #{cour_stat}
			<if test="cour_stat == '1' and category2_key != null">
			,AND CHG_DT = NOW()
			</if>
		WHERE COUR_NO = #{cour_no}
		  AND EDU_NO = #{edu_no}
	</update><!--수정해야함-->
	
	<select id="getInsActList" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT a.SCHEDULE_NO, a.EDU_START_DATE AS EDU_DATE,
	       CONCAT(SUBSTR(TIME(b.START_TIME),1,2),':',SUBSTR(TIME(b.START_TIME),4,2),'~',SUBSTR(TIME(b.END_TIME),1,2),':',SUBSTR(TIME(b.END_TIME),4,2)) AS EDU_DATETIME,
	       (SELECT CD_NM FROM COM_CD_MNG WHERE UP_CD_NO = '32' AND CD = b.COPER_AREA_CD) AS AREA_NM,
	       b.EDU_PLACE, a.EDU_ORG_NAME, a.EDU_NAME, a.EDU_TARGET, a.EDU_NUMBER, c.REG_DT, 
	       CASE WHEN b.INS_STATUS IS NULL THEN '취소하기'
				ELSE '변경불가' END AS INS_STATUS, 
	       CASE WHEN c.INS_CONFIRM = 'Y' THEN '선택'
				ELSE '미선택' END AS INS_CONFIRM, a.EDU_KEY
		FROM EDU_SCHEDULE a,
			 EDU_SCHEDULE_DETAIL b,
		     EDU_SCHEDULE_APP c
		WHERE a.SCHEDULE_NO = b.SCHEDULE_NO
		AND a.SCHEDULE_NO = c.SCHEDULE_NO
		AND c.INS_USER = #{UserAccount.user_id}
		<choose>
			<when test="searchDate !=null and searchDate !='' and searchDate =='ALL' ">
			</when>
			<when
				test="searchDate !=null and searchDate !='' and searchDate =='TODAY' ">
				AND EDU_START_DATE = NOW()
			</when>
			<when
				test="searchDate !=null and searchDate !='' and searchDate =='CHECK' ">
		      <![CDATA[
		       AND  EDU_START_DATE >= #{start_date} AND EDU_START_DATE <= #{end_date} 
		       ]]>
			</when>
		</choose>
		<if test="edu_nm != '' and edu_nm != null">
			AND a.EDU_NAME LIKE CONCAT('%',#{edu_nm},'%') 
		</if>
		<if test="area_nm != '' and area_nm != null">
			AND b.COPER_AREA_CD = #{area_nm}
		</if>
		<if test="edu_org_name != '' and edu_org_name != null">
			AND a.EDU_ORG_NAME LIKE CONCAT('%',#{edu_org_name},'%') 
		</if>
		LIMIT #{recordCountPerPage} OFFSET #{offset}
	</select>
	
	<select id="getInsActListCnt" parameterType="java.util.Map" resultType="int">
		SELECT COUNT(*) 
		FROM EDU_SCHEDULE a,
			 EDU_SCHEDULE_DETAIL b,
		     EDU_SCHEDULE_APP c
		WHERE a.SCHEDULE_NO = b.SCHEDULE_NO
		AND a.SCHEDULE_NO = c.SCHEDULE_NO
		AND c.INS_USER = #{UserAccount.user_id}
		<choose>
			<when test="searchDate !=null and searchDate !='' and searchDate =='ALL' ">
			</when>
			<when
				test="searchDate !=null and searchDate !='' and searchDate =='TODAY' ">
				AND EDU_START_DATE = NOW()
			</when>
			<when
				test="searchDate !=null and searchDate !='' and searchDate =='CHECK' ">
		      <![CDATA[
		       AND  EDU_START_DATE >= #{start_date} AND EDU_START_DATE <= #{end_date} 
		       ]]>
			</when>
		</choose>
		<if test="edu_nm != '' and edu_nm != null">
			AND a.EDU_NAME LIKE CONCAT('%',#{edu_nm},'%') 
		</if>
		<if test="area_nm != '' and area_nm != null">
			AND b.COPER_AREA_CD = #{area_nm}
		</if>
		<if test="edu_org_name != '' and edu_org_name != null">
			AND a.EDU_ORG_NAME LIKE CONCAT('%',#{edu_org_name},'%') 
		</if>
	</select>
	
	<select id="getAreaList" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT CD, CD_NM 
		FROM COM_CD_MNG 
		WHERE UP_CD_NO = '32'
	</select>

	<select id="getInsLeaveList" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT INSTRUCTOR_LEAVE_IDX, 
			   CASE WHEN STATUS = '1' THEN '승인'
			   		ELSE '미승인' END AS STATUS, 
			   REASON, 
			   S_DATE, 
			   E_DATE,
			   REG_DT  
		FROM EDU_INSTRUCTOR_LEAVE
		WHERE INSTRUCTOR_IDX = (SELECT INSTRUCTOR_IDX FROM EDU_INSTRUCTOR WHERE COM_USER_ID = #{UserAccount.user_id})
		<choose>
			<when test="searchDate !=null and searchDate !='' and searchDate =='ALL' ">
			</when>
			<when
				test="searchDate !=null and searchDate !='' and searchDate =='TODAY' ">
				AND REG_DT = NOW()
			</when>
			<when
				test="searchDate !=null and searchDate !='' and searchDate =='CHECK' ">
		      <![CDATA[
		       AND  REG_DT >= #{start_date} AND REG_DT <= #{end_date} 
		       ]]>
			</when>
		</choose>
		LIMIT #{recordCountPerPage} OFFSET #{offset}
	</select>
	
	<select id="getInsLeaveListCnt" parameterType="java.util.Map" resultType="int">
		SELECT COUNT(*) 
		FROM EDU_INSTRUCTOR_LEAVE
		WHERE INSTRUCTOR_IDX = (SELECT INSTRUCTOR_IDX FROM EDU_INSTRUCTOR WHERE COM_USER_ID = #{UserAccount.user_id})
		<choose>
			<when test="searchDate !=null and searchDate !='' and searchDate =='ALL' ">
			</when>
			<when
				test="searchDate !=null and searchDate !='' and searchDate =='TODAY' ">
				AND EDU_START_DATE = NOW()
			</when>
			<when
				test="searchDate !=null and searchDate !='' and searchDate =='CHECK' ">
		      <![CDATA[
		       AND  EDU_START_DATE >= #{start_date} AND EDU_START_DATE <= #{end_date} 
		       ]]>
			</when>
		</choose>
	</select>
	
</mapper>
